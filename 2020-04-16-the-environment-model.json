{"version":2,"kind":"Article","sha256":"bb19946182a0a22b66464c126bdf898df44994d7cfee9a4fcd7ba51663b1d43b","slug":"2020-04-16-the-environment-model","location":"/CS3110/2020-04-16-The-Environment-Model.md","dependencies":[],"frontmatter":{"title":"The Environment Model","tags":["Cornell","20SP","CS3110"],"date":"2020-04-16","numbering":{"title":{"offset":1}},"exports":[{"format":"md","filename":"2020-04-16-The-Environment-Model.md","url":"/cornell-notes/build/2020-04-16-The-Envir-89d2e03b93402e5695b8f4b1e184bcc3.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Step Relation","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"NxJZBLOEda"}],"identifier":"step-relation","label":"Step Relation","html_id":"step-relation","implicit":true,"key":"hkkd71PaZc"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"General Rules: don’t step on values; don’t step on variables","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"yEtitPBDNf"}],"key":"j7z7ORQUb2"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Small/Single Step Relation","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"qYPpKezTYj"}],"key":"pPmRjxNRrR"},{"type":"text","value":": ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"o5lI1cv2Ww"},{"type":"inlineCode","value":"e --> e'","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"jt0neG89p8"},{"type":"text","value":", where e’ can be a value or another expression yet to be evaluated to a value","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"XZwMjVcF3m"}],"key":"pdxSbAFvhW"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Multi-Step Relation","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"jHox6f445O"}],"key":"RJoxn7bJAd"},{"type":"text","value":": ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"lfQNK2W4Bk"},{"type":"inlineCode","value":"e -->* e'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"zJNxG5VkRp"},{"type":"text","value":" is the reflexive closure of single step. It allows single step to be performed 0 or multiple times","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"PsdH2eXk9R"}],"key":"PnpvCVWz0b"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Big-Step Relation","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"slxbCshEFo"}],"key":"hWHTi437v1"},{"type":"text","value":": ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"S98yvjjqsW"},{"type":"inlineCode","value":"e ==> v","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"WJYWKeuCPp"},{"type":"text","value":" step expressions to values through multi-step and stop when it becomes values.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"GA7ptFBxAJ"}],"key":"uBFKxVjobh"}],"key":"Qe8vy1FIdp"},{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"link","url":"https://www.cs.cornell.edu/courses/cs3110/2020sp/textbook/interp/env_model.html","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"kNt4P84nXq"}],"urlSource":"https://www.cs.cornell.edu/courses/cs3110/2020sp/textbook/interp/env_model.html","key":"RgOLsafZeH"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"wDLZws3MZh"},{"type":"blockquote","position":{"start":{"line":20,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"For sake of efficiency, it would be better to substitute ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"tiwle13XfD"},{"type":"emphasis","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"lazily","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"a7idwg60et"}],"key":"YyoDrSx9Ht"},{"type":"text","value":": only when the value of a variable is needed should the interpreter have to do the substitution. That’s the key idea behind the ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"gEOPi9ETLq"},{"type":"emphasis","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"environment model","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"VDhX0CrdPb"}],"key":"LeCDAiixuh"},{"type":"text","value":". In this model, there is a data structure called the ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"jYSZTri5lh"},{"type":"emphasis","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"dynamic environment","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"JZUo8H5Vkz"}],"key":"Ut5OqE1IbJ"},{"type":"text","value":", which is a dictionary mapping variable names to values. Whenever the value of a variable is needed, it’s looked up in that dictionary. （空间换时间）","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"uTKlQCpt1t"}],"key":"gycmf4cJqh"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Instead of ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"jFGMN4nI13"},{"type":"inlineCode","value":"e ==> v","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"bCueDjwMiQ"},{"type":"text","value":", we now have ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"tYFdsgA1z8"},{"type":"inlineCode","value":"<env, e> ==> v","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"bqAcziEZ6Z"},{"type":"text","value":", where ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"M8OEiIo5V5"},{"type":"inlineCode","value":"env","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"mwquBAzaKu"},{"type":"text","value":" denotes the environment, and ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"kKHZjddRfn"},{"type":"inlineCode","value":"<env, e>","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"lKFdwnybIy"},{"type":"text","value":" is called a ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"GDjPchk3MC"},{"type":"emphasis","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"machine configuration","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"qpql9lv6dk"}],"key":"pSRtlHipW1"},{"type":"text","value":". That configuration represents the state of the computer as it evaluates a program: ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"hXr8rIi4Ib"},{"type":"inlineCode","value":"env","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"yShUe0VS61"},{"type":"text","value":" represents a part of the computer’s memory (the binding of variables to values), and ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"RuvUAUobfc"},{"type":"inlineCode","value":"e","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"XG1rsH8wEd"},{"type":"text","value":" represents the program.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"eJLk0Zp95A"}],"key":"MvzMcWDsOK"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":24,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"inlineCode","value":"{}","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"AcVw0cpiJs"},{"type":"text","value":" represent the empty environment,","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"OmHOvJamvD"}],"key":"zYcAKVjcJj"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"inlineCode","value":"{x1:v1, x2:v2, ...}","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"FNTGzNun6D"},{"type":"text","value":" represent the environment that binds ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"JnN5by0K9r"},{"type":"inlineCode","value":"x1","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"Sbc9vV7BT2"},{"type":"text","value":" to ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"jR21rjekk6"},{"type":"inlineCode","value":"v1","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"bqCRmNEOG0"},{"type":"text","value":", etc.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"sW2t0vBZVF"}],"key":"yQHNHoVBrM"},{"type":"listItem","spread":true,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"inlineCode","value":"env[x -> v]","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"bzJkFpPTcG"},{"type":"text","value":" represent the environment ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"DINqTpos2D"},{"type":"inlineCode","value":"env","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"blAGEFEcQq"},{"type":"text","value":" with the variable ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"AqhTnPiegb"},{"type":"inlineCode","value":"x","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"igcq1lRhFg"},{"type":"text","value":" additionally bound to the value ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"vPCOpsOrqf"},{"type":"inlineCode","value":"v","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"iBCU2YOjXs"}],"key":"w2JDBfQYP8"},{"type":"listItem","spread":true,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"inlineCode","value":"env(x)","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"SZwe7lIxU4"},{"type":"text","value":" represent the binding of ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"yj1aqkCVsF"},{"type":"inlineCode","value":"x","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"FkS2FykPQO"},{"type":"text","value":" in ","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"gWAEqTs6AT"},{"type":"inlineCode","value":"env","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"jePz8uiubM"},{"type":"text","value":".","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"nA1V9KH3Fa"}],"key":"WpraCYsKnE"}],"key":"SdLlLo8ZAy"}],"key":"TlbtCUTkcP"},{"type":"heading","depth":2,"position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Evaluation","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"V1YCvQAU4n"}],"identifier":"evaluation","label":"Evaluation","html_id":"evaluation","implicit":true,"key":"ih7u6EE3zo"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Trivially,","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"mBSX7YXMza"}],"key":"UZ5kEBcScQ"},{"type":"code","lang":"Ocaml","value":"<env, x> ==> env(x)\n<env, fun x -> e> ==> fun x -> e","position":{"start":{"line":33,"column":1},"end":{"line":36,"column":1}},"key":"gGVoXTI7yy"},{"type":"heading","depth":3,"position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Problem","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"mDccUuCdm9"}],"identifier":"problem","label":"Problem","html_id":"problem","implicit":true,"key":"wylAlDiQ8a"},{"type":"paragraph","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"However, when we try to define the rules of function application, we run into trouble. Intuitively, we would write something like this, where we sort of “substitute” all the occurrences of ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"C4w5C8UjXF"},{"type":"inlineCode","value":"x","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"FAVf7PqYTH"},{"type":"text","value":" in ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"MgCEhJW6Zi"},{"type":"inlineCode","value":"e","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"bzqQGUOrtT"},{"type":"text","value":" with ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"VPYAh1a7J5"},{"type":"inlineCode","value":"v2","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"Ws1yInP96b"},{"type":"text","value":" and get the result ","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"njUKXWZQCy"},{"type":"inlineCode","value":"v","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"QqW0hMDIlY"},{"type":"text","value":".","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"aamOczd9uh"}],"key":"modF0JnbOO"},{"type":"code","lang":"","value":"<env, e1 e2> ==> v\n  if <env, e1> ==> fun x -> e\n  and <env, e2> ==> v2\n  and <env[x -> v2], e> ==> v","position":{"start":{"line":42,"column":1},"end":{"line":47,"column":1}},"key":"DGhVKibfr2"},{"type":"blockquote","position":{"start":{"line":49,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"code","lang":"ocaml","value":"let x = 1 in\nlet f = fun y -> x in\nlet x = 2 in\nf 0","position":{"start":{"line":49,"column":1},"end":{"line":54,"column":1}},"key":"aw5JSQpUZR"},{"type":"paragraph","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"According to our semantics thus far, it would evaluate as follows:","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"Sr1lmIYClC"}],"key":"QXeR0MVkF8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":58,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":58,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"inlineCode","value":"let x = 1","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"AOPD9anROS"},{"type":"text","value":" would produce the environment ","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"iMbJHrANeM"},{"type":"inlineCode","value":"{x:1}","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"ZzkuFFiMGZ"},{"type":"text","value":".","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"ARD4o7XJns"}],"key":"j9BcxqXCbO"}],"key":"iCqivfxWRz"},{"type":"listItem","spread":true,"position":{"start":{"line":60,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"inlineCode","value":"let f = fun y -> x","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"ep7yFftGJi"},{"type":"text","value":" would produce the environment ","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"gwVALOzvvd"},{"type":"inlineCode","value":"{x:1, f:(fun y -> x)}","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"y11auQDyXx"},{"type":"text","value":".","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"iBSE6XfnKb"}],"key":"ybGZgu3Rw6"}],"key":"KyEiG0ruVi"},{"type":"listItem","spread":true,"position":{"start":{"line":62,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"inlineCode","value":"let x = 2","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"lP3SAareTR"},{"type":"text","value":" would produce the environment ","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"JobfYEl22r"},{"type":"inlineCode","value":"{x:2, f:(fun y -> x)}","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"Qc92STDNZj"},{"type":"text","value":". Note how the binding of ","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"juu8Crd7Qc"},{"type":"inlineCode","value":"x","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"EvlJL0w8Td"},{"type":"text","value":" to ","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"tnrseFoSnO"},{"type":"inlineCode","value":"1","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"LercHlgQPa"},{"type":"text","value":" is shadowed by the new binding.","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"OGfeKWvpXe"}],"key":"cuGn9DPayb"}],"key":"oPKd2dHPux"},{"type":"listItem","spread":true,"position":{"start":{"line":64,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"Now we would evaluate ","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"c0orlTewZV"},{"type":"inlineCode","value":"<{x:2, f:(fun y -> x)}, f 0>","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"EmUl0VPNl5"}],"key":"lmCh8YyDLo"},{"type":"code","lang":"ocaml","value":"<{x:2, f:(fun y -> x)}, f 0> ==> 2\n  because <{x:2, f:(fun y -> x)}, f> ==> fun y -> x\n  and <{x:2, f:(fun y -> x)}, 0> ==> 0\n  and <{x:2, f:(fun y -> x)}[y -> 0], x> ==> 2`\n    because <{x:2, f:(fun y -> x), y:0}, x> ==> 2`","position":{"start":{"line":66,"column":1},"end":{"line":72,"column":1}},"key":"rR0ZqFBzF8"}],"key":"XxuC75Y9Zc"},{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"text","value":"The result is therefore ","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"QlKodPsC4V"},{"type":"inlineCode","value":"2","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"uOhhLrR68D"},{"type":"text","value":".","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"enI6EmZZoB"}],"key":"lmjH021APP"}],"key":"qMsmWydB3d"}],"key":"DajOKH6Ogl"}],"key":"iAkspnm4t4"},{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"However, this should evaluate to 1. Notice that we evaluated e1 in the current environment, or more formally, we used a dynamic scope here.","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"TLXxF96x2J"}],"key":"zmUl12ujiI"},{"type":"heading","depth":3,"position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Dynamic vs. Static Scope","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"CstqBqKWXu"}],"identifier":"dynamic-vs-static-scope","label":"Dynamic vs. Static Scope","html_id":"dynamic-vs-static-scope","implicit":true,"key":"YcWjTMgv8D"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":80,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"strong","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"Dynamic Scope","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"TllLPncFlY"}],"key":"lNji2KnUJs"},{"type":"text","value":": the body of a function is evaluated in the current dynamic environment at the time the function is ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"EsD9cRlK6T"},{"type":"strong","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"called","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"RJtpFjq0u8"}],"key":"o77CCfS0OB"},{"type":"text","value":", i.e. it uses the latest binding","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"GFaUpBhlU8"}],"key":"NdALq8NJLU"},{"type":"listItem","spread":true,"position":{"start":{"line":81,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"strong","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"Lexical Scope","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"SyJA5FIJFk"}],"key":"QptLm4RqO3"},{"type":"text","value":": the body of a function is evaluated in the old dynamic environment that existed at the time the function was ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"VxtQMN6OIZ"},{"type":"strong","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"defined","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"AA40fXCGbo"}],"key":"GF62uBgQ4O"},{"type":"text","value":".","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"D2d09t0Fuz"}],"key":"ePX4MP5SyF"}],"key":"Qybx18JZsX"},{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"Most modern languages use lexical scope.","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"u99TLFRyDD"}],"key":"jqD9VoiIyw"},{"type":"heading","depth":3,"position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"Implementing Time Travel","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"BhRVKfKhV1"}],"identifier":"implementing-time-travel","label":"Implementing Time Travel","html_id":"implementing-time-travel","implicit":true,"key":"b9M2AoJpnQ"},{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"We have to store the variable binding at the time the function was defined. We define a new data structure called “closure” with two parts: ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"yNea98mo7R"},{"type":"inlineCode","value":"(|exp, env|)","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"ohnZ1U2HY4"},{"type":"text","value":", where ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"ah17a4936H"},{"type":"inlineCode","value":"exp","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"br6V4t52BK"},{"type":"text","value":" is the expression we are concerned about, and ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"QBxosI43G8"},{"type":"inlineCode","value":"env","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"HgSYpE07V3"},{"type":"text","value":" the environment when the expression was defined.","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"ajF1jQMNCG"}],"key":"u2ecCnRbkt"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"Since we only have to consider scope in function application, the ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"g6qXNzn21V"},{"type":"inlineCode","value":"exp","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"prZZ1yXXMg"},{"type":"text","value":" in our closure must always be a function, denoted by ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"gk2RoOhgj3"},{"type":"inlineCode","value":"fun x -> e","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"orlQuwH7gf"},{"type":"text","value":". Therefore, we can also write our closure as ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"VbGY4ge4AS"},{"type":"inlineCode","value":"(|x, exp, env|)","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"XySgZRbiTH"},{"type":"text","value":", where ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"gvwqaUq745"},{"type":"inlineCode","value":"x","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"MQkR5BVFeT"},{"type":"text","value":" is the argument name, ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"eMXS1iwOoz"},{"type":"inlineCode","value":"e","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"mWwtemSYEz"},{"type":"text","value":" is the function body, and ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"oLjlDbrt12"},{"type":"inlineCode","value":"env","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"fKsHQDqyO8"},{"type":"text","value":" is the environment when this function was defined. In fact, that’s how we define it when implementing the Environment Model.","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"ihG3ZN7y44"}],"key":"qi1Bm37LHX"},{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"When we use big-step relation in evaluation, we say the result must be a value. Here, we can consider ","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"ByORjH9DZ2"},{"type":"emphasis","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"closure","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"oIcvVbJaId"}],"key":"k69mGTsA5w"},{"type":"text","value":" to be the value evaluated from a function. ","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"kTBwzLo4hM"},{"type":"inlineCode","value":"<env, fun x -> e> ==> (| fun x -> e, env |)","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"hA2wKkWRoG"}],"key":"tNrF11CwXh"},{"type":"paragraph","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"Using closure, we can now correctly define evaluation of function applications. (","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"hMMWvFNXty"},{"type":"inlineCode","value":"defenv","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"rdNrYWwaSM"},{"type":"text","value":" represents the environment when ","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"lLo4YGVYgw"},{"type":"inlineCode","value":"e1","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"D01EhsKubz"},{"type":"text","value":" was defined)","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"hxl30QHDPa"}],"key":"TfcG2QmJCI"},{"type":"code","lang":"Ocaml","value":"<env, e1 e2> ==> v\n  if <env, e1> ==> (| fun x -> e, defenv |)\n  and <env, e2> ==> v2\n  and <defenv[x -> v2], e> ==> v","position":{"start":{"line":95,"column":1},"end":{"line":100,"column":1}},"key":"enlRCBoMzw"}],"key":"B2hrnDTa2b"}],"key":"zSZPLvRoen"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"The Substitution Model","url":"/2020-04-14-the-substitution-model","group":"C S3110"},"next":{"title":"Machine Learning Basics","url":"/2021-08-31-machine-learning-basics","group":"C S4780"}}},"domain":"http://localhost:3000"}